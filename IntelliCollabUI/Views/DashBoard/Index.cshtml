
@{
    ViewBag.Title = "Index";
}
<style>
    /*body{
        height:120vh !important;
    }*/

    .small-box {
        border-radius: 2px;
        position: relative;
        display: block;
        margin-bottom: 20px;
        box-shadow: 0 1px 1px rgba(0,0,0,0.1);
    }

        .small-box > .inner {
            padding: 10px;
        }

        .small-box .icon {
            -webkit-transition: all .3s linear;
            -o-transition: all .3s linear;
            transition: all .3s linear;
            position: absolute;
            top: -10px;
            right: 10px;
            z-index: 0;
            font-size: 90px;
            color: rgba(0, 0, 0, 0.15);
        }

        .small-box > .small-box-footer {
            position: relative;
            text-align: center;
            padding: 3px 0;
            color: #fff;
            color: rgba(255, 255, 255, 0.8);
            display: block;
            z-index: 10;
            background: rgba(0, 0, 0, 0.1);
            text-decoration: none;
        }

    .bg-aqua {
        background-color: #00c0ef !important;
    }

    .product-img .product-info {
        float: left;
    }

    .image-box {
        font-size: 3rem;
        padding-right: 1.5rem;
    }

    .text-sky {
        color: #3c8dbc;
    }

    #msg {
        height: 60vh;
        overflow-y: scroll;
        overflow-x: hidden;
    }
    .cursor{
        cursor:pointer !important;
    }
</style>
<div class="row">
    <div class="col-lg-3 col-md-3 col-sm-12">
        <div class="small-box bg-aqua">
            <div class="inner text-white">
                <p>Total Current Student</p>
                <h3 id="noOfStd">150000</h3>
            </div>
            <div class="icon">
                <i class="fa-solid fa-users"></i>
            </div>
            <a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
        </div>
    </div>
    <div class="col-lg-3 col-md-3 col-sm-12">
        <div class="small-box bg-aqua">
            <div class="inner text-white">
                <p>Total Current Faculty</p>
                <h3 id="noOfFaculty">150</h3>
            </div>
            <div class="icon">
                <i class="fa-solid fa-users"></i>
            </div>
            <a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
        </div>
    </div>
    <div class="col-lg-3 col-md-3 col-sm-12">
        <div class="small-box bg-aqua">
            <div class="inner text-white">
                <p>Total Current Branch</p>
                <h3 id="noOfBranch">6</h3>
            </div>
            <div class="icon">
                <i class="fa fa-code-branch"></i>
            </div>
            <a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
        </div>
    </div>
    <div class="col-lg-3 col-md-3 col-sm-12">
        <div class="small-box bg-aqua">
            <div class="inner text-white">
                <p>Others options</p>
                <h3>Admission</h3>
            </div>
            <div class="icon">
                <i class="fa-solid fa-clipboard-user"></i>
            </div>
            <a href="http://www.mditm.com/admissions.php" target="_blank" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-lg-8 col-md-8 col-sm-12">
        <div class="row">
            <div class="col-12">
                <div class="card m-1 mb-3">
                    <div class="card-header">
                        <div class="input-group">
                            <span class="input-group-text text-white bg-primary" id="basic-addon1">Session</span>
                            <select id="ddlSession" class="form-select">
                                <option>2020-2024</option>
                                <option>2021-2025</option>
                                <option>2022-2026</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="chartContainer" style="height: 366px; width: 100%;"></div>
                    </div>
                </div>
            </div>
            <div class="col-12">
                <div class="row">
                    @if (Session["UserRole"] != null && (!Session["UserRole"].ToString().Equals("A")))
                    {
                        <div class="col-lg-2 col-md-12 col-sm-12  ">
                            <div id="personalInfo" class="small-box bg-aqua cursor">
                                <div class="inner text-white text-center">
                                    <h5><i class="fa fa-user"></i> You</h5>
                                </div>
                            </div>
                        </div>
                    }
                    <div class="col-lg-2 col-md-12 col-sm-12  ">
                        <div id="jutForm" class="small-box bg-aqua cursor">
                            <div class="inner text-white text-center">
                                <h5><i class="fa fa-external-link-alt"></i> JUT Form</h5>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-12 col-sm-12">
                        <div id="lib" class="small-box bg-aqua cursor">
                            <div class="inner text-white text-center">
                                <h5><i class="fa-solid fa-book"></i> Library</h5>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-12 col-sm-12">
                        <div id="result" class="small-box bg-aqua cursor">
                            <div class="inner text-white text-center">
                                <h5><i class="fa-regular fa-newspaper"></i> Result</h5>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-12 col-sm-12">
                        <div id="event" class="small-box bg-aqua cursor">
                            <div class="inner text-white text-center">
                                <h5><i class="fa-regular fa-calendar-days"></i> Event</h5>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-12 col-sm-12">
                        <div class="small-box bg-aqua cursor">
                            <div id="AIbtn" class="inner text-white text-center" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                                <h5><i class="fa-solid fa-robot"></i> AI</h5>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-4 col-md-4 col-sm-12">
        <div class="row">
            <div class="col-12">
                <div class="card" style="height: 27vh;overflow-y: auto;">
                    <div class="card-header dark-theme text-white">
                        Notice Board
                    </div>
                    <ul class="list-group list-group-flush" id="noticeId">
                        <li class="list-group-item">
                            <h3>Exam</h3>
                            <p>Start Date: 20/05/2024 and End Date: 26/05/2024</p>
                        </li>
                        <li class="list-group-item">A second item</li>
                        <li class="list-group-item">A third item</li>
                    </ul>

                </div>
            </div>
            <!--faculty List-->
            <div class="col-12 mt-2">
                <div class="card" style="height: 35vh;overflow-y: auto;">
                    <div class="card-header dark-theme text-white">
                        Faculty List(HOD)
                    </div>
                    <ul class="list-group list-group-flush" id="facultyList">
                        <li class="list-group-item">
                            <div class="image-box float-start">
                                <i class="fa-regular fa-image"></i>
                            </div>
                            <div class="inner float-start">
                                <h5 class="text-sky">Somrita Jana</h5>
                                <p>Computer Science Engineering</p>
                            </div>
                        </li>
                        <li class="list-group-item">
                            <div class="image-box float-start">
                                <i class="fa-regular fa-image"></i>
                            </div>
                            <div class="inner float-start">
                                <h5 class="text-sky">Somrita Jana</h5>
                                <p>Computer Science Engineering</p>
                            </div>
                        </li>
                        <li class="list-group-item">
                            <div class="image-box float-start">
                                <i class="fa-regular fa-image"></i>
                            </div>
                            <div class="inner float-start">
                                <h5 class="text-sky">Somrita Jana</h5>
                                <p>Computer Science Engineering</p>
                            </div>
                        </li>
                    </ul>

                </div>
            </div>
        </div>
    </div>
</div>
<!--model-->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header dark-theme">
                <h5 class="modal-title " id="staticBackdropLabel">Live Chat</h5>
                <button type="button" class="btn-close bg-danger" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body dark-theme ">
                <div class="card border-0" id="chat1" style="border-radius: 15px;">
                    
                    <div class="card-body" id="msg">

                    </div>
                    <div class="card-footer">
                        <div class="form-floating mb-3">
                            <input type="email" class="form-control" id="floatingInput" placeholder="name@example.com">
                            <label for="floatingInput">Type your message</label>
                        </div>
                        <div class="d-flex justify-content-center">
                            <button class="input-group-text me-2" id="chatId"> <i class="fa-solid fa-paper-plane"></i></button>
                            <button class="input-group-text ms-2" id="clear"> <i class="fa fa-refresh"></i></button>
                            <button class="btn btn-danger ms-2" data-bs-dismiss="modal"><i class="fa fa-close"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--Chat Bot-->
<script>
    var chart;
    var gender = `@Convert.ToString(Session["GENDER"])`;
    $(() => {

        getDashBordInfo();
        getAllHODList();
        getTop3Notice();
        getGraphData();
    });

  //  ======================================================== AI Code Start ===============================================
    $('#chatId').click(() => {
        if ($('#floatingInput').val() == undefined || $('#floatingInput').val() == "")
            return;
        let usr = UserReqTemp($('#floatingInput').val());
        $('#msg').append(usr);
        $("#msg").scrollTop($("#msg")[0].scrollHeight);

        let url = `@Url.Action("TalkWithAiV2", "ChatBot")?ques=${$('#floatingInput').val()}`;
        $.ajax({
            url:url,
            method: "GET",
            beforeSend: function (xhr) {
                console.log("Before Section");
                $('#floatingInput').val('');
                $('#staticBackdropLabel').text("Live Chat typing...")
            },
            dataType: 'json',
            contentType: 'application/json;charset=utf-8',
            statusCode: {
                404: function () {
                    alert("page not found");
                },
                505: function () {
                    alert("Internal Server Error");
                }

            }
        }).done(function (e) {
            console.table(e);

        }).always(function (e) {
            let AI = "";

            if (e.CHAT_DESCRIPTION != undefined) {
                AI = ChatBotRespTemp(e.CHAT_DESCRIPTION);

            } else {
                AI = ChatBotRespTemp("Oops!. I am offline.");
            }

            $('#msg').append(AI);
            $("#msg").scrollTop($("#msg")[0].scrollHeight);
            $('#staticBackdropLabel').text("Live Chat");
        });


    });
    $('#clear').click(() => {
        $('#msg').empty();
        WelcomeChat();
    });
    function UserReqTemp(ques) {

        let img = gender == 'S' ? 'admin.png' : (gender == 'F' ? 'girlAVT.png' : 'boyAVT.png');

        return `<div class="d-flex flex-row justify-content-end mb-4">
                    <div class="p-3 me-3 border" style="border-radius: 15px; background-color: #6b8ae8;">
                        <p class="small mb-0">${ques}</p>
                    </div>
                    <img src="../Content/Images/${img}" alt="avatar 1" style="width: 45px; height: 100%;">
                </div>`;
    }

    function ChatBotRespTemp(bot) {
        return `<div class="d-flex flex-row justify-content-start mb-4">
                    <img src="../Content/Images/bot.png"
                            alt="avatar 1" style="width: 45px; height: 100%;">
                    <div class="p-3 ms-3" style="border-radius: 15px; background-color: rgba(57, 192, 237,.2);">
                        <p class="small mb-0">
                            ${bot}
                        </p>
                    </div>
                </div>`;
    }

    function WelcomeChat() {
        $('#msg').empty();

        let url = `@Url.Action("WelcomeMsg", "ChatBot")`;
        $.ajax({
            url: url,
            method: "GET",
            beforeSend: function (xhr) {
                console.log("Before Section");
                $('#floatingInput').val('');
            },
            dataType: 'json',
            contentType: 'application/json;charset=utf-8',
            statusCode: {
                404: function () {
                    alert("page not found");
                },
                505: function () {
                    alert("Internal Server Error");
                }
            }
        }).done(function (e) {
            console.table(e);

        }).always(function (e) {

            let AI = ChatBotRespTemp(e.CHAT_DESCRIPTION);
            $('#msg').append(AI);
            //var element = document.getElementById("msg");
            //typeWriter(element, AI, 10);
            $("#msg").scrollTop($("#msg")[0].scrollHeight);
        });
    }

    $("#AIbtn").click(() => {
        WelcomeChat();
    });

    //function typeWriter(element, text, speed) {
    //    var i = 0;
    //    var interval = setInterval(function () {
    //        if (i < text.length) {
    //            element.textContent += text.charAt(i);
    //            i++;
    //        } else {
    //            clearInterval(interval);
    //        }
    //    }, speed);
    //}

// ========================================================= AI Code End ==================================================


    function getDashBordInfo() {
        $.ajax({
            url: '@Url.Action("GetDashBoardResult","DashBoard")',
            method: "GET",
            beforeSend: function (xhr) {
                console.log("Before Section");
                $('#noOfStd').text("");
                $('#noOfFaculty').text("");
                $('#noOfBranch').text("");
            },
            dataType: 'json',
            contentType: 'application/json;charset=utf-8',
            statusCode: {
                404: function () {
                    alert("page not found");
                },
                505: function () {
                    alert("Internal Server Error");
                }
            }
        }).done(function (e) {
            console.table(e);

        }).always(function (e) {

            $('#noOfStd').text(e.NoOfStudent);
            $('#noOfFaculty').text(e.NoOfFaculty);
            $('#noOfBranch').text(e.NoOfBranch);
        });
    }
//===========================================Faculty List Start==================================
    function getAllHODList() {
        $.ajax({
            url: '@Url.Action("GetAllHODList", "DashBoard")',
            method: "GET",
            beforeSend: function (xhr) {
                console.log("Before Section");
            },
            dataType: 'json',
            contentType: 'application/json;charset=utf-8',
            statusCode: {
                404: function () {
                    alert("page not found");
                },
                505: function () {
                    alert("Internal Server Error");
                }
            }
        }).done(function (e) {
            console.table(e);
            facultyListGenerate(e);
        }).always(function (e) {

        });
    }

    function facultyListGenerate(dataSet) {
        let row = ``;

        $.each(dataSet, function (i, e) {

            let img = "";

            if (e.IMAGE_BASE64 != null && e.IMAGE_BASE64 != "") {
                img = e.IMAGE_BASE64 ;
            } else {
                if (e.GENDER == "F") {
                    img = "../Content/Images/FemailTeacher.png";
                } else {
                    img = "../Content/Images/MailTeacher.png";
                }
            }


            row += `<li class="list-group-item">
                        <div class="image-box float-start">
                            <img id="idImage" src="${img}" height="70" width="50" class="card-img-top" alt="...">
                        </div>
                        <div class="inner float-start">
                            <h6 class="text-sky">${e.F_NAME}</h5>
                            <p>${e.BRANCH_ID}</p>
                        </div>
                    </li>`
        });

        $('#facultyList').html(row);
    }
//=============================================Faculty list End and top 3 noticeb start=============================
    function getTop3Notice() {
        $.ajax({
            url: '@Url.Action("GetTop3EventList", "DashBoard")',
            method: "GET",
            beforeSend: function (xhr) {
                console.log("Before Section");
            },
            dataType: 'json',
            contentType: 'application/json;charset=utf-8',
            statusCode: {
                404: function () {
                    alert("page not found");
                },
                505: function () {
                    alert("Internal Server Error");
                }
            }
        }).done(function (e) {
            console.table(e);
            generateNoticeList(e);
        }).always(function (e) {

        });
    }

    function generateNoticeList(dataSet) {
        let row = ``;
        if (dataSet != null && dataSet.length > 0) {
            $.each(dataSet, function (i,e) {
                row += ` <li class="list-group-item" style='font-size: small;height: 4rem;'>
                            <h6>${e.EVENT_NAME}</h5>
                            <p>Start Date: ${e.STR_START_DATE} and End Date: ${e.STR_END_DATE}</p>
                        </li>`;
            });
        }

        $("#noticeId").html(row);
    }
//=============================================Top 3 noticeb End and graph start ====================================
//=============================================graph work start======================================================
    function getGraphData() {
        let session = $('#ddlSession').val();
        $.ajax({
            url: `@Url.Action("GetOverallStudentNo", "DashBoard")?Sessions=${session}`,
            method: "GET",
            beforeSend: function (xhr) {
                console.log("Before Section");
            },
            dataType: 'json',
            contentType: 'application/json;charset=utf-8',
            statusCode: {
                404: function () {
                    alert("page not found");
                },
                505: function () {
                    alert("Internal Server Error");
                }
            }
        }).done(function (e) {
            console.table(e);
            let dataSet = [];
            if (e.GraphData.length > 0) {
                dataSet = [...new Set(e.GraphData.map(x => x.BRANCH))].map((x) => { return { y: e.GraphData.filter(y => y.BRANCH == x).length, label: x } });
            }


            $.each(e.BranchList, function (i, item) {
                if (!dataSet.some(x => x.label === item)) {
                    dataSet.push({ y: 0, label: item });
                }
            });

            showGraph(dataSet);
        }).always(function (e) {

        });
    }

    $('#ddlSession').change(() => {
        getGraphData();
    });

    function showGraph(dataSet) {
        if (dataSet == null && dataSet.length == 0) {
            dataSet = [
                { y: 95, label: "CS" },
                { y: 88, label: "ME" },
                { y: 70, label: "EE" },
                { y: 82, label: "ECE" },
                { y: 90, label: "CE" }
            ];
        }



        chart = new CanvasJS.Chart("chartContainer", {
            animationEnabled: true,
            theme: "light2", // "light1", "light2", "dark1", "dark2"
            title: {
                text: "Overall Students"
            },
            axisY: {
                title: "No Of Student"
            },
            axisX: {
                title: "Branch"
            },
            data: [{
                type: "column",
                showInLegend: false,
                name: "",
                legendText: "",
                dataPoints: dataSet
            }]
        });
        chart.render();
    }
//============================================graph work end =====================================================
//===============================================navigation session===============================================
    $('#event').click(() => {
        window.location = '@Url.Action("CalendarView", "UserManagement")';
    });
     $('#result').click(() => {
        window.location = '@Url.Action("Results", "UserManagement")';
     });
     $('#lib').click(() => {
        window.location = '@Url.Action("DigitalLibraryDashBoard", "DigitalLibrary")';
     });
     $('#personalInfo').click(() => {
        window.location = '@Url.Action("PersonalInfo", "UserManagement")';
     });//

    $('#jutForm').click(() => {
        window.location = 'https://jutgyanjyoti.jharkhand.gov.in/';
     });
 //==============================================End navigation session ==========================================
</script>